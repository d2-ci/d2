{"version":3,"sources":["../../src/system/SystemSettings.js"],"names":["SystemSettings","api","getApi","settings","Promise","resolve","get","then","systemSettingsKey","processValue","value","JSON","parse","e","reject","TypeError","options","headers","accept","join","undefined","response","Error","settingUrl","length","delete","post"],"mappings":";;;;;;;;AAAA;;AACA;;;;;;;;AAEA;;;;;;;;AAQA;IACMA,c;AACF,8BAAgC;AAAA,YAApBC,GAAoB,uEAAd,cAAIC,MAAJ,EAAc;;AAAA;;AAC5B,aAAKD,GAAL,GAAWA,GAAX;AACH;;AAED;;;;;;;;;;;;;;;8BAWM;AAAA;;AACF,mBAAO,KAAKE,QAAL,GACDC,QAAQC,OAAR,CAAgB,KAAKF,QAArB,CADC,GAED,KAAKF,GAAL,CAASK,GAAT,CAAa,gBAAb,EACGC,IADH,CACQ,UAACJ,QAAD,EAAc;AAChB,sBAAKA,QAAL,GAAgBA,QAAhB;AACA,uBAAOC,QAAQC,OAAR,CAAgB,MAAKF,QAArB,CAAP;AACH,aAJH,CAFN;AAOH;;AAED;;;;;;;;;;;;;;;;;4BAcIK,iB,EAAmB;AAAA;;AACnB,gBAAI,KAAKL,QAAL,IAAiB,KAAKA,QAAL,CAAcK,iBAAd,CAArB,EAAuD;AACnD,uBAAOJ,QAAQC,OAAR,CAAgB,KAAKF,QAAL,CAAcK,iBAAd,CAAhB,CAAP;AACH;;AAED,qBAASC,YAAT,CAAsBC,KAAtB,EAA6B;AACzB;AACA,oBAAI;AACA,2BAAOC,KAAKC,KAAL,CAAWF,KAAX,CAAP;AACH,iBAFD,CAEE,OAAOG,CAAP,EAAU;AACR,2BAAOH,KAAP;AACH;AACJ;;AAED,mBAAO,IAAIN,OAAJ,CAAY,UAACC,OAAD,EAAUS,MAAV,EAAqB;AACpC,oBAAI,CAAC,qBAASN,iBAAT,CAAL,EAAkC;AAC9B,0BAAM,IAAIO,SAAJ,CAAc,4EAAd,CAAN;AACH;;AAED,oBAAMC,UAAU,EAAEC,SAAS,EAAEC,QAAQ,YAAV,EAAX,EAAhB;AACA,uBAAKjB,GAAL,CAASK,GAAT,CACI,CAAC,gBAAD,EAAmBE,iBAAnB,EAAsCW,IAAtC,CAA2C,GAA3C,CADJ,EACqDC,SADrD,EACgEJ,OADhE,EAEKT,IAFL,CAEU,UAACc,QAAD,EAAc;AAChB,wBAAIA,QAAJ,EAAc;AACVhB,gCAAQI,aAAaY,QAAb,CAAR;AACH;AACDP,2BAAO,IAAIQ,KAAJ,CAAU,6DAAV,CAAP;AACH,iBAPL;AAQH,aAdM,CAAP;AAeH;;;4BAEGd,iB,EAAmBE,K,EAAO;AAC1B,mBAAO,KAAKP,QAAZ;;AAEA,gBAAMoB,aAAa,CAAC,gBAAD,EAAmBf,iBAAnB,EAAsCW,IAAtC,CAA2C,GAA3C,CAAnB;AACA,gBAAIT,UAAU,IAAV,IAAkB,MAAIA,KAAJ,EAAac,MAAb,KAAwB,CAA9C,EAAiD;AAC7C,uBAAO,KAAKvB,GAAL,CAASwB,MAAT,CAAgBF,UAAhB,CAAP;AACH;AACD,mBAAO,KAAKtB,GAAL,CAASyB,IAAT,CAAcH,UAAd,EAA0Bb,KAA1B,EAAiC,EAAEO,SAAS,EAAE,gBAAgB,YAAlB,EAAX,EAAjC,CAAP;AACH;;;;;;kBAGUjB,c","file":"SystemSettings.js","sourcesContent":["import { isString } from '../lib/check';\nimport Api from '../api/Api';\n\n/**\n * @description\n * Handles communication with the systemSettings endpoint. Can be used to get or save systemSettings.\n *\n * @memberof module:system\n * @requires lib/check\n * @requires api/Api\n */\n// TODO: Return the values from the local cache if we have not updated it? We could\nclass SystemSettings {\n    constructor(api = Api.getApi()) {\n        this.api = api;\n    }\n\n    /**\n     * Loads all the system settings in the system and returns them as an object from the promise.\n     *\n     * @returns {Promise} Promise that resolves with the systemsettings object from the api.\n     *\n     * @example\n     * d2.system.settings.all()\n     *  .then(systemSettings => {\n     *    console.log('Analytics was last updated on: ' + systemSettings.keyLastSuccessfulResourceTablesUpdate);\n     *  });\n     */\n    all() {\n        return this.settings\n            ? Promise.resolve(this.settings)\n            : this.api.get('systemSettings')\n                .then((settings) => {\n                    this.settings = settings;\n                    return Promise.resolve(this.settings);\n                });\n    }\n\n    /**\n     * Get a single systemSetting for the given key.\n     *\n     * This will use the cached value of the key if it has been previously loaded.\n     *\n     * @param {String} systemSettingsKey The identifier of the system setting that should be retrieved.\n     * @returns {Promise} A promise that resolves with the value or will fail if the value is not available.\n     *\n     * @example\n     * d2.system.settings.get('keyLastSuccessfulResourceTablesUpdate')\n     *  .then(systemSettingsValue => {\n     *    console.log('Analytics was last updated on: ' + systemSettingsValue);\n     *  });\n     */\n    get(systemSettingsKey) {\n        if (this.settings && this.settings[systemSettingsKey]) {\n            return Promise.resolve(this.settings[systemSettingsKey]);\n        }\n\n        function processValue(value) {\n            // Attempt to parse the response as JSON. If this fails we return the value as is.\n            try {\n                return JSON.parse(value);\n            } catch (e) {\n                return value;\n            }\n        }\n\n        return new Promise((resolve, reject) => {\n            if (!isString(systemSettingsKey)) {\n                throw new TypeError('A \"key\" parameter should be specified when calling get() on systemSettings');\n            }\n\n            const options = { headers: { accept: 'text/plain' } };\n            this.api.get(\n                ['systemSettings', systemSettingsKey].join('/'), undefined, options)\n                .then((response) => {\n                    if (response) {\n                        resolve(processValue(response));\n                    }\n                    reject(new Error('The requested systemSetting has no value or does not exist.'));\n                });\n        });\n    }\n\n    set(systemSettingsKey, value) {\n        delete this.settings;\n\n        const settingUrl = ['systemSettings', systemSettingsKey].join('/');\n        if (value === null || (`${value}`).length === 0) {\n            return this.api.delete(settingUrl);\n        }\n        return this.api.post(settingUrl, value, { headers: { 'Content-Type': 'text/plain' } });\n    }\n}\n\nexport default SystemSettings;\n"]}