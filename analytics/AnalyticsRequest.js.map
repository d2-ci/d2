{"version":3,"sources":["../../src/analytics/AnalyticsRequest.js"],"names":["AnalyticsRequest","model","passFilterAsDimension","request","columns","rows","concat","forEach","d","dimension","filter","addDimension","items","map","item","id","filters","f","addFilter","AnalyticsRequestBase"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACMA,gB;;;;;;;;;;;;AAKF;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;8BACcC,K,EAAsC;AAAA,UAA/BC,qBAA+B,uEAAP,KAAO;AAC5C,UAAIC,OAAO,GAAG,IAAd,CAD4C,CAG5C;;AACA,UAAMC,OAAO,GAAGH,KAAK,CAACG,OAAN,IAAiB,EAAjC;AACA,UAAMC,IAAI,GAAGJ,KAAK,CAACI,IAAN,IAAc,EAA3B;AAEAD,MAAAA,OAAO,CAACE,MAAR,CAAeD,IAAf,EAAqBE,OAArB,CAA6B,UAAAC,CAAC,EAAI;AAAA,YACxBC,SADwB,GACVD,CADU,CACxBC,SADwB;;AAG9B,YAAID,CAAC,CAACE,MAAN,EAAc;AACVD,UAAAA,SAAS,eAAQD,CAAC,CAACE,MAAV,CAAT;AACH;;AAEDP,QAAAA,OAAO,GAAGA,OAAO,CAACQ,YAAR,CACNF,SADM,EAEND,CAAC,CAACI,KAAF,CAAQC,GAAR,CAAY,UAAAC,IAAI;AAAA,iBAAIA,IAAI,CAACC,EAAT;AAAA,SAAhB,CAFM,CAAV;AAIH,OAXD,EAP4C,CAoB5C;;AACA,UAAMC,OAAO,GAAGf,KAAK,CAACe,OAAN,IAAiB,EAAjC;AAEAA,MAAAA,OAAO,CAACT,OAAR,CAAgB,UAAAU,CAAC,EAAI;AACjBd,QAAAA,OAAO,GAAGD,qBAAqB,GACzBC,OAAO,CAACQ,YAAR,CACIM,CAAC,CAACR,SADN,EAEIQ,CAAC,CAACL,KAAF,CAAQC,GAAR,CAAY,UAAAC,IAAI;AAAA,iBAAIA,IAAI,CAACC,EAAT;AAAA,SAAhB,CAFJ,CADyB,GAKzBZ,OAAO,CAACe,SAAR,CACID,CAAC,CAACR,SADN,EAEIQ,CAAC,CAACL,KAAF,CAAQC,GAAR,CAAY,UAAAC,IAAI;AAAA,iBAAIA,IAAI,CAACC,EAAT;AAAA,SAAhB,CAFJ,CALN;AASH,OAVD;AAYA,aAAOZ,OAAP;AACH;;;;EA5D0B,8CAC3B,2CACI,8CAAgCgB,6BAAhC,CADJ,CAD2B,C;;eA+DhBnB,gB","sourcesContent":["import AnalyticsRequestDimensionsMixin from './AnalyticsRequestDimensionsMixin'\nimport AnalyticsRequestFiltersMixin from './AnalyticsRequestFiltersMixin'\nimport AnalyticsRequestPropertiesMixin from './AnalyticsRequestPropertiesMixin'\nimport AnalyticsRequestBase from './AnalyticsRequestBase'\n\n/**\n * @description\n * Class for constructing a request object to use for communicating with the analytics API endpoint.\n *\n * @param {!Object} options Object with analytics request options\n *\n * @memberof module:analytics\n *\n * @extends module:analytics.AnalyticsRequestDimensionsMixin\n * @extends module:analytics.AnalyticsRequestFiltersMixin\n * @extends module:analytics.AnalyticsRequestPropertiesMixin\n * @extends module:analytics.AnalyticsRequestBase\n */\nclass AnalyticsRequest extends AnalyticsRequestDimensionsMixin(\n    AnalyticsRequestFiltersMixin(\n        AnalyticsRequestPropertiesMixin(AnalyticsRequestBase)\n    )\n) {\n    /**\n     * Extracts dimensions and filters from an analytic object model and add them to the request\n     *\n     * @param {Object} model The analytics object model from which extract the dimensions/filters\n     * @param {Boolean} [passFilterAsDimension=false] Pass filters as dimension in the query string (used in dataValueSet requests)\n     *\n     * @returns {AnalyticsRequest} A new instance of the class for chaining purposes\n     *\n     * @example\n     * const req = new d2.analytics.request()\n     *    .fromModel(model);\n     *\n     * // dimension=pe:LAST_12_MONTH&dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU;Jtf34kNZhzP;hfdmMSPBgLG&filter=ou:ImspTQPwCqd\n     *\n     * const req2 = new d2.analytics.request()\n     *    .fromModel(model, true);\n     *\n     * // dimension=pe:LAST_12_MONTH&dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU;Jtf34kNZhzP;hfdmMSPBgLG&dimension=ou:ImspTQPwCqd\n     */\n    fromModel(model, passFilterAsDimension = false) {\n        let request = this\n\n        // extract dimensions from model\n        const columns = model.columns || []\n        const rows = model.rows || []\n\n        columns.concat(rows).forEach(d => {\n            let { dimension } = d\n\n            if (d.filter) {\n                dimension += `:${d.filter}`\n            }\n\n            request = request.addDimension(\n                dimension,\n                d.items.map(item => item.id)\n            )\n        })\n\n        // extract filters from model\n        const filters = model.filters || []\n\n        filters.forEach(f => {\n            request = passFilterAsDimension\n                ? request.addDimension(\n                      f.dimension,\n                      f.items.map(item => item.id)\n                  )\n                : request.addFilter(\n                      f.dimension,\n                      f.items.map(item => item.id)\n                  )\n        })\n\n        return request\n    }\n}\n\nexport default AnalyticsRequest\n"],"file":"AnalyticsRequest.js"}