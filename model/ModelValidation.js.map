{"version":3,"sources":["../../src/model/ModelValidation.js"],"names":["extractValidationViolations","webmessage","response","errorReports","error","Error","Promise","reject","ModelValidation","providedLogger","logger","warn","model","modelDefinition","name","url","Api","getApi","post","catch","e","then","webMessage","status","modelValidation","Logger","getLogger","console"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;;;AAEA,SAASA,2BAAT,CAAqCC,UAArC,EAAiD;AAC7C,MAAIA,UAAU,CAACC,QAAX,IAAuBD,UAAU,CAACC,QAAX,CAAoBC,YAA/C,EAA6D;AACzD,WAAOF,UAAU,CAACC,QAAX,CAAoBC,YAA3B;AACH;;AAED,MAAMC,KAAK,GAAG,IAAIC,KAAJ,CAAU,wDAAV,CAAd;AACA,SAAOC,OAAO,CAACC,MAAR,CAAeH,KAAf,CAAP;AACH;AAED;;;;;;;IAKMI,e;;;AACF,2BAAYC,cAAZ,EAA4B;AAAA;;AACxB,0BAAUA,cAAV,EAA0B,QAA1B,EAAoC,iBAApC;AACA,SAAKC,MAAL,GAAcD,cAAd;AACH;AAED;;;;;;;;;+BAKW;AACP,WAAKC,MAAL,CAAYC,IAAZ,CAAiB,4CAAjB;AACA,YAAM,IAAIN,KAAJ,CAAU,4CAAV,CAAN;AACH;AAED;;;;;;;;;;;0CAQsBO,K,EAAO;AAAE;AAC3B,UAAI,EAAEA,KAAK,IAAIA,KAAK,CAACC,eAAf,IAAkCD,KAAK,CAACC,eAAN,CAAsBC,IAA1D,CAAJ,EAAqE;AACjE,eAAOR,OAAO,CAACC,MAAR,CAAe,6CAAf,CAAP;AACH;;AAED,UAAMQ,GAAG,qBAAcH,KAAK,CAACC,eAAN,CAAsBC,IAApC,CAAT,CALyB,CAOzB;;AACA,aAAOE,aAAIC,MAAJ,GAAaC,IAAb,CAAkBH,GAAlB,EAAuB,gCAAqBH,KAArB,CAAvB,EACFO,KADE,CACI,UAAAC,CAAC;AAAA,eAAId,OAAO,CAACC,MAAR,CAAea,CAAf,CAAJ;AAAA,OADL,EAEFC,IAFE,CAEG,UAACC,UAAD,EAAgB;AAClB,YAAIA,UAAU,CAACC,MAAX,KAAsB,IAA1B,EAAgC;AAC5B,iBAAO,EAAP;AACH;;AACD,eAAOjB,OAAO,CAACC,MAAR,CAAee,UAAf,CAAP;AACH,OAPE,EAQFH,KARE,CAQInB,2BARJ,CAAP;AASH;AAED;;;;;;;;;yCAM4B;AACxB,UAAI,KAAKwB,eAAT,EAA0B;AACtB,eAAO,KAAKA,eAAZ;AACH;;AACD,aAAQ,KAAKA,eAAL,GAAuB,IAAIhB,eAAJ,CAAoBiB,gBAAOC,SAAP,CAAiBC,OAAjB,CAApB,CAA/B;AACH;;;;;;eAGUnB,e","sourcesContent":["import { checkType } from '../lib/check';\nimport Logger from '../logger/Logger';\nimport Api from '../api/Api';\nimport { getOwnedPropertyJSON } from './helpers/json';\n\nfunction extractValidationViolations(webmessage) {\n    if (webmessage.response && webmessage.response.errorReports) {\n        return webmessage.response.errorReports;\n    }\n\n    const error = new Error('Response was not a WebMessage with the expected format');\n    return Promise.reject(error);\n}\n\n/**\n * Handles validation of Model objects based on their modelDefinition.\n *\n * @memberof module:model\n */\nclass ModelValidation {\n    constructor(providedLogger) {\n        checkType(providedLogger, 'object', 'logger (Logger)');\n        this.logger = providedLogger;\n    }\n\n    /**\n     * @deprecated Client side model validation is deprecated in favour of server side validation only.\n     *\n     * @returns {{status: boolean, messages: Array}} Returns {status: true, messages: []}\n     */\n    validate() {\n        this.logger.warn('Client side model validation is deprecated');\n        throw new Error('Client side model validation is deprecated');\n    }\n\n    /**\n     * Sends a POST request against the `api/schemas` endpoint to check if the model is valid.\n     *\n     * @param {Model} model The model that should be validated.\n     * @returns {Array} Returns an array with validation messages if there are any.\n     *\n     * @note {warn} Currently only checks\n     */\n    validateAgainstSchema(model) { // eslint-disable-line class-methods-use-this\n        if (!(model && model.modelDefinition && model.modelDefinition.name)) {\n            return Promise.reject('model.modelDefinition.name can not be found');\n        }\n\n        const url = `schemas/${model.modelDefinition.name}`;\n\n        // TODO: The function getOwnedPropertyJSON should probably not be exposed, perhaps we could have a getJSONForModel(ownedPropertiesOnly=true) method.\n        return Api.getApi().post(url, getOwnedPropertyJSON(model))\n            .catch(e => Promise.reject(e))\n            .then((webMessage) => {\n                if (webMessage.status === 'OK') {\n                    return [];\n                }\n                return Promise.reject(webMessage);\n            })\n            .catch(extractValidationViolations);\n    }\n\n    /**\n     * Returns the `ModelValidation` singleton. Creates a new one if it does not yet exist.\n     * Grabs a logger instance by calling `Logger.getLogger`\n     *\n     * @returns {ModelValidation} New or memoized instance of `ModelInstance`\n     */\n    static getModelValidation() {\n        if (this.modelValidation) {\n            return this.modelValidation;\n        }\n        return (this.modelValidation = new ModelValidation(Logger.getLogger(console)));\n    }\n}\n\nexport default ModelValidation;\n"],"file":"ModelValidation.js"}