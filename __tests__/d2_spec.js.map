{"version":3,"sources":["../../src/__tests__/d2_spec.js"],"names":["jest","mock","describe","ModelDefinition","name","prototype","ModelDefinitionMock","createFromSchema","fn","mockReturnValue","d2","apiMock","loggerMock","i18nMock","beforeEach","callCount","schemasResponse","schemas","fixtures","get","mockReturnValueOnce","Promise","resolve","version","apps","setBaseUrl","getApi","setDefaultHeaders","error","addSource","addStrings","load","Logger","getLogger","Api","I18n","getI18n","ModelDefinitionsMock","ModelDefinitions","modelsMockList","add","schema","getModelDefinitions","require","default","afterEach","it","expect","init","toBe","getInstance","done","undefined","then","toHaveBeenCalledTimes","catch","config","baseUrl","toHaveBeenCalledWith","headers","Authorization","Buffer","toString","i18n","sources","e","strings","toBeInstanceOf","all","d2FromInit","d2FromFactory","firstCallResult","secondCallResult","instanceAfterFirstInit","first","instanceAfterSecondInit","second","not","toBeCalled","shouldThrowOnString","shouldThrowOnFunction","toThrowError","shouldNotThrow","fields","reject","Error","newD2","attributeCallArgs","calls","toEqual","paging","models","toBeDefined","dataElement","currentUser","d2Instance","dataStore","DataStore","getUserSettings","settings","keyUiLocale","getManifest","expectedManifest","manifest","activities","dhis","href","getBaseUrl"],"mappings":"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","sourcesContent":["import Api from '../api/Api';\nimport fixtures from '../__fixtures__/fixtures';\nimport I18n from '../i18n/I18n';\nimport DataStore from '../datastore/DataStore';\nimport Logger from '../logger/Logger';\n\njest.mock('../logger/Logger');\njest.mock('../api/Api');\njest.mock('../i18n/I18n');\n\ndescribe('D2', () => {\n    const ModelDefinition = function ModelDefinition() {\n        this.name = 'dataElement';\n    };\n\n    ModelDefinition.prototype = {};\n\n    const ModelDefinitionMock = {\n        createFromSchema: jest.fn().mockReturnValue(new ModelDefinition()),\n        prototype: {},\n    };\n    let d2;\n    let apiMock;\n    let loggerMock;\n    let i18nMock;\n\n    beforeEach(() => {\n        ModelDefinitionMock.createFromSchema.callCount = 0;\n        const schemasResponse = {\n            schemas: [\n                fixtures.get('/api/schemas/dataElement'),\n                fixtures.get('/api/schemas/dataElement'),\n                fixtures.get('/api/schemas/dataElement'),\n            ],\n        };\n\n        apiMock = {\n            get: jest.fn()\n                // First init round\n                .mockReturnValueOnce(Promise.resolve(schemasResponse))\n                .mockReturnValueOnce(new Promise(resolve => resolve(fixtures.get('/api/attributes'))))\n                .mockReturnValueOnce(Promise.resolve({}))\n                .mockReturnValueOnce(Promise.resolve([]))\n                .mockReturnValueOnce(new Promise(resolve => resolve(fixtures.get('/api/userSettings'))))\n                .mockReturnValueOnce(Promise.resolve({ version: '2.21' }))\n                .mockReturnValueOnce(Promise.resolve({ apps: [] }))\n\n                // Second init round\n                .mockReturnValueOnce(new Promise(resolve => resolve(schemasResponse)))\n                .mockReturnValueOnce(new Promise(resolve => resolve(fixtures.get('/api/attributes'))))\n                .mockReturnValueOnce(Promise.resolve({}))\n                .mockReturnValueOnce(Promise.resolve([]))\n                .mockReturnValueOnce(new Promise(resolve => resolve(fixtures.get('/api/userSettings'))))\n                .mockReturnValueOnce(Promise.resolve({ version: '2.21' }))\n                .mockReturnValueOnce(Promise.resolve({ apps: [] })),\n            setBaseUrl: jest.fn(),\n            getApi() {\n                return this;\n            },\n            setDefaultHeaders: jest.fn(),\n        };\n\n        loggerMock = {\n            error: jest.fn(),\n        };\n\n        i18nMock = {\n            addSource: jest.fn(),\n            addStrings: jest.fn(),\n            load: jest.fn()\n                .mockReturnValue(Promise.resolve()),\n        };\n\n        Logger.getLogger = Logger.getLogger.mockReturnValue(loggerMock);\n        Api.getApi = Api.getApi.mockReturnValue(apiMock);\n        I18n.getI18n = I18n.getI18n.mockReturnValue(i18nMock);\n\n        // jscs:disable\n        const ModelDefinitionsMock = function ModelDefinitions() {\n            this.modelsMockList = true;\n            this.add = function add(schema) {\n                this[schema.name] = schema;\n            };\n        };\n        // jscs:enable\n        ModelDefinitionsMock.prototype = {\n            add(schema) {\n                this[schema.name] = schema;\n            },\n        };\n        ModelDefinitionsMock.getModelDefinitions = jest.fn().mockReturnValue(new ModelDefinitionsMock());\n\n        // Import after we have set all the mock values\n        // TODO: should probably use jest.mock and use a regular ES6 import\n        d2 = require('../d2').default; // eslint-disable-line global-require\n    });\n\n    afterEach(() => {\n\n    });\n\n    it('should have an init function', () => {\n        expect(typeof d2.init).toBe('function');\n    });\n\n    it('should have a getInstance function', () => {\n        expect(typeof d2.getInstance).toBe('function');\n    });\n\n    describe('init', () => {\n        it('should call load on i18n instance', (done) => {\n            d2.init(undefined, apiMock);\n            d2.getInstance()\n                .then(() => {\n                    expect(i18nMock.load).toHaveBeenCalledTimes(1);\n                    done();\n                })\n                .catch(done);\n        });\n    });\n\n    describe('config', () => {\n        it('should have a default baseUrl in the config', () => {\n            expect(d2.config.baseUrl).toBe('/api');\n        });\n\n        it('should use the baseUrl from the pre-init config', (done) => {\n            d2.config.baseUrl = '/dhis/api';\n\n            d2.init(undefined, apiMock);\n            d2.getInstance()\n                .then(() => {\n                    expect(apiMock.setBaseUrl).toHaveBeenCalledWith('/dhis/api');\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should let the init() config override the pre-init config', (done) => {\n            d2.config.baseUrl = '/dhis/api';\n\n            d2.init({ baseUrl: '/demo/api' }, apiMock);\n            d2.getInstance()\n                .then(() => {\n                    expect(apiMock.setBaseUrl).toHaveBeenCalledWith('/demo/api');\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should use default headers for requests', (done) => {\n            d2.config.baseUrl = '/dhis/api';\n            d2.config.headers = {\n                Authorization: new Buffer('admin:district').toString('base64'),\n            };\n\n            d2.init({ baseUrl: '/demo/api' }, apiMock);\n            d2.getInstance()\n                .then(() => {\n                    expect(apiMock.setDefaultHeaders).toHaveBeenCalledWith({ Authorization: 'YWRtaW46ZGlzdHJpY3Q=' });\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should pass the sources Set as an sources array to the i18n class', (done) => {\n            d2.config.i18n.sources.add('global.properties');\n            d2.config.i18n.sources.add('nonglobal.properties');\n            d2.config.i18n.sources.add('systemsettings.properties');\n\n            d2.init(undefined, apiMock);\n            d2.getInstance()\n                .then(() => {\n                    expect(i18nMock.addSource).toHaveBeenCalledTimes(3);\n                    done();\n                })\n                .catch((e) => {\n                    done(e);\n                });\n        });\n\n        it('should call addStrings for the pre-init added strings', (done) => {\n            d2.config.i18n.strings.add('name');\n            d2.config.i18n.strings.add('yes');\n\n            d2.init(undefined, apiMock);\n            d2.getInstance()\n                .then(() => {\n                    expect(i18nMock.addStrings).toHaveBeenCalledWith(['name', 'yes']);\n                    done();\n                })\n                .catch((e) => {\n                    done(e);\n                });\n        });\n    });\n\n    describe('getInstance', () => {\n        it('should return a promise', () => {\n            expect(d2.getInstance()).toBeInstanceOf(Promise);\n        });\n\n        it('should return the d2 instance after init', (done) => {\n            Promise.all([d2.init({ baseUrl: '/dhis/api' }, apiMock), d2.getInstance()])\n                .then(([d2FromInit, d2FromFactory]) => {\n                    expect(d2FromInit).toBe(d2FromFactory);\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should return the same instance on getInstance calls', (done) => {\n            d2.init({ baseUrl: '/dhis/api' }, apiMock);\n\n            Promise.all([d2.getInstance(), d2.getInstance()])\n                .then(([firstCallResult, secondCallResult]) => {\n                    expect(firstCallResult).toBe(secondCallResult);\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should return a different instance after re-init', (done) => {\n            d2.init(undefined, apiMock);\n            const instanceAfterFirstInit = d2.getInstance();\n\n            instanceAfterFirstInit.then((first) => {\n                d2.init({ baseUrl: '/dhis/api' }, apiMock);\n                const instanceAfterSecondInit = d2.getInstance();\n\n                return Promise.all([first, instanceAfterSecondInit]);\n            })\n                .then(([first, second]) => {\n                    expect(first).not.toBe(second);\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should return a promise when calling getInstance before init', () => {\n            expect(d2.getInstance()).toBeInstanceOf(Promise);\n        });\n    });\n\n    it('should set the base url onto the api', () => {\n        d2.init({ baseUrl: '/dhis/api' }, apiMock);\n\n        expect(apiMock.setBaseUrl).toHaveBeenCalledWith('/dhis/api');\n    });\n\n    it('should set the baseUrl to the default /api', () => {\n        d2.init({}, apiMock);\n\n        expect(apiMock.setBaseUrl).toBeCalled();\n    });\n\n    it('should throw an error when the passed config is not an object', () => {\n        function shouldThrowOnString() {\n            d2.init(' ');\n        }\n\n        function shouldThrowOnFunction() {\n            d2.init(() => true);\n        }\n\n        expect(shouldThrowOnString).toThrowError('Expected Config parameter to have type object');\n        expect(shouldThrowOnFunction).toThrowError('Expected Config parameter to have type object');\n    });\n\n    it('should not throw an error when no config is passed', () => {\n        function shouldNotThrow() {\n            d2.init(undefined, apiMock);\n        }\n\n        expect(shouldNotThrow).not.toThrowError();\n    });\n\n    it('should call the api', () => d2.init({ baseUrl: '/dhis/api' }, apiMock)\n        .then(() => {\n            const fields = 'apiEndpoint,name,displayName,authorities,singular,plural,' +\n                'shareable,metadata,klass,identifiableObject,translatable,' +\n                'properties[href,writable,collection,collectionName,name,propertyType,persisted,required,min,max,' +\n                'ordered,unique,constants,owner,itemPropertyType,translationKey,embeddedObject]';\n\n            expect(apiMock.get).toHaveBeenCalledWith('schemas', { fields });\n        }));\n\n    it('should log the error when schemas can not be requested', () => {\n        apiMock.get = jest.fn().mockReturnValueOnce(Promise.reject(new Error('Failed')));\n\n        return d2.init({ baseUrl: '/dhis/api' }, apiMock, loggerMock)\n            .then(\n                () => Promise.reject('No error occurred'),\n                () => {\n                    expect(loggerMock.error).toHaveBeenCalledTimes(1);\n                    expect(loggerMock.error)\n                        .toHaveBeenCalledWith('Unable to get schemas from the api', '{}', new Error('Failed'));\n                },\n            );\n    });\n\n    it('should return an object with the api object', (done) => {\n        d2.init({ baseUrl: '/dhis/api' }, apiMock)\n            .then((newD2) => {\n                expect(newD2.Api.getApi()).toBe(apiMock);\n                done();\n            })\n            .catch(done);\n    });\n\n    it('should call the api for all startup calls', (done) => {\n        d2.init({ baseUrl: '/dhis/api' }, apiMock)\n            .then(() => {\n                expect(apiMock.get).toHaveBeenCalledTimes(7);\n                done();\n            })\n            .catch(done);\n    });\n\n    it('should query the api for all the attributes', (done) => {\n        d2.init({ baseUrl: '/dhis/api' }, apiMock)\n            .then(() => {\n                const attributeCallArgs = apiMock.get.mock.calls[1];\n                /* 0: Url, 1: Data, 1: Query params, 2: Request options */\n                expect(attributeCallArgs[0]).toBe('attributes');\n                expect(attributeCallArgs[1]).toEqual({ fields: ':all,optionSet[:all,options[:all]]', paging: false });\n                done();\n            })\n            .catch(done);\n    });\n\n    describe('creation of ModelDefinitions', () => {\n        it('should add the model definitions object to the d2 object', (done) => {\n            d2.init(undefined, apiMock)\n                .then((newD2) => {\n                    expect(newD2.models).toBeDefined();\n                    // expect(newD2.models.modelsMockList).to.equal(true);\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should add the ModelDefinitions to the models list', (done) => {\n            d2.init(undefined, apiMock)\n                .then((newD2) => {\n                    expect(newD2.models.dataElement).toBeDefined();\n                    done();\n                })\n                .catch(done);\n        });\n    });\n\n    describe('currentUser', () => {\n        it('should be available on the d2 object', () => {\n            d2.init(undefined, apiMock);\n\n            return d2.getInstance()\n                .then((newD2) => {\n                    expect(newD2.currentUser).toBeDefined();\n                });\n        });\n    });\n\n    describe('with specific schema loading', () => {\n        it('should have only loaded a single schema', () => {\n            apiMock.get\n                // First init round\n                .mockReturnValueOnce(Promise.resolve(fixtures.get('/api/schemas/user')));\n\n            d2.init({\n                schemas: ['user'],\n            }, apiMock);\n\n            return d2.getInstance()\n                .then(() => {\n                    expect(apiMock.get).toHaveBeenCalledWith('schemas/user', {\n                        fields: 'apiEndpoint,name,displayName,authorities,singular,plural,shareable,metadata,klass,' +\n                        'identifiableObject,translatable,' +\n                        'properties[href,writable,collection,collectionName,name,propertyType,persisted,required,min,' +\n                        'max,ordered,unique,constants,owner,itemPropertyType,translationKey,embeddedObject]',\n                    });\n                });\n        });\n    });\n\n    describe('DataStore', () => {\n        it('should have a dataStore object on the instance', () => d2.init(undefined, apiMock)\n            .then((d2Instance) => {\n                expect(d2Instance.dataStore).toBeInstanceOf(DataStore);\n            }));\n    });\n\n    describe('getUserSettings', () => {\n        it('should be a function', () => {\n            expect(typeof d2.getUserSettings).toBe('function');\n        });\n\n        it('should return an object with the uiLocale', () => {\n            apiMock.get = jest.fn().mockReturnValueOnce(Promise.resolve(fixtures.get('/api/userSettings')));\n\n            return d2.getUserSettings(apiMock)\n                .then((settings) => {\n                    expect(settings.keyUiLocale).toBe('fr');\n                });\n        });\n\n        it('should call the api for keyUiLocale', () => {\n            d2.getUserSettings(apiMock);\n\n            expect(apiMock.get).toBeCalled();\n        });\n\n        it('should use the default base url when the set baseUrl is not valid', (done) => {\n            d2.config.baseUrl = undefined;\n\n            d2.getUserSettings(apiMock)\n                .then(() => {\n                    expect(apiMock.setBaseUrl).not.toBeCalled();\n                    expect(apiMock.get).toHaveBeenCalledWith('userSettings');\n                    done();\n                })\n                .catch(done);\n        });\n    });\n\n    describe('getManifest', () => {\n        it('should be a function', () => {\n            expect(typeof d2.getManifest).toBe('function');\n        });\n\n        it('should return a promise', () => {\n            expect(d2.getManifest('manifest.webapp', apiMock)).toBeInstanceOf(Promise);\n        });\n\n        it('should request the manifest.webapp', (done) => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve({}));\n\n            d2.getManifest('manifest.webapp', apiMock)\n                .then(() => {\n                    expect(apiMock.get).toHaveBeenCalledWith('manifest.webapp');\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should return the manifest.webapp object', (done) => {\n            const expectedManifest = {\n                name: 'MyApp',\n            };\n\n            apiMock.get = jest.fn().mockReturnValueOnce(Promise.resolve(expectedManifest));\n\n            d2.getManifest('manifest.webapp', apiMock)\n                .then((manifest) => {\n                    expect(manifest.name).toBe(expectedManifest.name);\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should add the getBaseUrl convenience method', (done) => {\n            const expectedManifest = {\n                name: 'MyApp',\n                activities: {\n                    dhis: {\n                        href: 'http://localhost:8080',\n                    },\n                },\n            };\n\n            apiMock.get = jest.fn().mockReturnValueOnce(Promise.resolve(expectedManifest));\n\n            d2.getManifest('manifest.webapp', apiMock)\n                .then((manifest) => {\n                    expect(manifest.getBaseUrl()).toBe('http://localhost:8080');\n                    done();\n                })\n                .catch(done);\n        });\n    });\n});\n"],"file":"d2_spec.js"}