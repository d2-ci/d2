{"version":3,"sources":["../../src/model/Model.js"],"names":["pickAttributeValues","Model","modelDefinition","modelProperties","Object","defineProperty","value","writable","configurable","defineProperties","attributes","attributeProperties","getAttributeValues","setAttributeValues","attributeValues","setDirty","dirty","attributeDefinitions","DIRTY_PROPERTY_LIST","Set","ModelBase"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,mBAAmB,GAAG,mBAAO,iBAAP,EAA0B,EAA1B,CAA5B,C,CAEA;;AACA;;;;;;;;;;IASMC,K;;;;;AACF;;;;;;;;;;;;AAYA,iBAAYC,eAAZ,EAA6B;AAAA;;AAAA;;AACzB;AACA,0BAAUA,eAAV,EAA2B,QAA3B,EAAqC,iBAArC;AACA,0BAAUA,eAAe,CAACC,eAA1B,EAA2C,QAA3C,EAAqD,iBAArD;AAEA;;;;;;AAKAC,IAAAA,MAAM,CAACC,cAAP,gCAA4B,iBAA5B,EAA+C;AAAEC,MAAAA,KAAK,EAAEJ;AAAT,KAA/C;AAEA;;;;;;;AAMAE,IAAAA,MAAM,CAACC,cAAP,gCAA4B,OAA5B,EAAqC;AAAEE,MAAAA,QAAQ,EAAE,IAAZ;AAAkBD,MAAAA,KAAK,EAAE;AAAzB,KAArC;AAEA;;;;;;;;AAOAF,IAAAA,MAAM,CAACC,cAAP,gCAA4B,YAA5B,EAA0C;AAAEG,MAAAA,YAAY,EAAE,IAAhB;AAAsBD,MAAAA,QAAQ,EAAE,IAAhC;AAAsCD,MAAAA,KAAK,EAAE;AAA7C,KAA1C;AAEA;;;;;;;AAMAF,IAAAA,MAAM,CAACK,gBAAP,gCAA8BP,eAAe,CAACC,eAA9C;AAEA,QAAMO,UAAU,GAAG,EAAnB;AACA,QAAMC,mBAAmB,GAAGT,eAAe,CAACS,mBAA5C;;AACA,QAAI,oBAAQA,mBAAR,CAAJ,EAAkC;AAC9B;;;;;;;;;;;;AAYAP,MAAAA,MAAM,CAACC,cAAP,gCAA4B,YAA5B,EAA0C;AAAEC,QAAAA,KAAK,EAAEI;AAAT,OAA1C;;AAEA,UAAME,kBAAkB,GAAG,SAArBA,kBAAqB;AAAA,eAAMZ,mBAAmB,+BAAzB;AAAA,OAA3B;;AACA,UAAMa,kBAAkB,GAAG,SAArBA,kBAAqB,CAAAC,eAAe;AAAA,eAAK,MAAKA,eAAL,GAAuBA,eAA5B;AAAA,OAA1C;;AACA,UAAMC,QAAQ,GAAG,SAAXA,QAAW;AAAA,eAAO,MAAKC,KAAL,GAAa,IAApB;AAAA,OAAjB;;AACA,UAAMC,oBAAoB,GAAG,wBACzBN,mBADyB,EAEzBC,kBAFyB,EAGzBC,kBAHyB,EAIzBE,QAJyB,CAA7B;AAOAX,MAAAA,MAAM,CAACK,gBAAP,CAAwBC,UAAxB,EAAoCO,oBAApC;AACH;;AAED,UAAKC,+BAAL,IAA4B,IAAIC,GAAJ,CAAQ,EAAR,CAA5B;AAnEyB;AAoE5B;AAED;;;;;;;;;;;;;;;;2BAYcjB,e,EAAiB;AAC3B,aAAO,IAAID,KAAJ,CAAUC,eAAV,CAAP;AACH;;;;EAjGekB,mB;;eAoGLnB,K","sourcesContent":["import { checkType, hasKeys } from '../lib/check';\nimport { pickOr } from '../lib/utils';\nimport ModelBase, { DIRTY_PROPERTY_LIST } from './ModelBase';\nimport createPropertyDefinitionsForAttributes from './helpers/attibutes';\n\nconst pickAttributeValues = pickOr('attributeValues', []);\n\n// TODO: Perhaps we can generate model classes dynamically based on the schemas and inherit from this.\n/**\n * @extends ModelBase\n *\n * @description\n * A Model represents an object from the DHIS2 Api. A model is created based of a ModelDefinition. The ModelDefinition\n * has the properties that the model should have.\n *\n * @memberof module:model\n */\nclass Model extends ModelBase {\n    /**\n     * @constructor\n     *\n     * @param {ModelDefinition} modelDefinition The model definition that corresponds with the model.\n     * This is essential defining what type the model is representing.\n     *\n     * @description\n     * Will create a new model instanced based on the model definition. When creating a new instance the model\n     * definition needs to have both the modelValidations and modelProperties.\n     *\n     * The model properties will depend on the ModelDefinition. A model definition is based on a DHIS2 Schema.\n     */\n    constructor(modelDefinition) {\n        super();\n        checkType(modelDefinition, 'object', 'modelDefinition');\n        checkType(modelDefinition.modelProperties, 'object', 'modelProperties');\n\n        /**\n         * @property {ModelDefinition} modelDefinition Stores reference to the modelDefinition that was used when\n         * creating the model. This property is not enumerable or writable and will therefore not show up when looping\n         * over the object properties.\n         */\n        Object.defineProperty(this, 'modelDefinition', { value: modelDefinition });\n\n        /**\n         * @property {Boolean} dirty Represents the state of the model. When the model is concidered `dirty`\n         * there are pending changes.\n         * This property is not enumerable or writable and will therefore not show up when looping\n         * over the object properties.\n         */\n        Object.defineProperty(this, 'dirty', { writable: true, value: false });\n\n        /**\n         * @private\n         * @property {Object} dataValues Values object used to store the actual model values. Normally access to the\n         * Model data will be done through accessor properties that are generated from the modelDefinition.\n         *\n         * @note {warning} This should not be accessed directly.\n         */\n        Object.defineProperty(this, 'dataValues', { configurable: true, writable: true, value: {} });\n\n        /**\n         * Attach the modelDefinition modelProperties (the properties from the schema) onto the Model.\n         *\n         * For a data element model the modelProperties would be the following\n         * https://play.dhis2.org/demo/api/schemas/dataElement.json?fields=properties\n         */\n        Object.defineProperties(this, modelDefinition.modelProperties);\n\n        const attributes = {};\n        const attributeProperties = modelDefinition.attributeProperties;\n        if (hasKeys(attributeProperties)) {\n            /**\n             * @property {Object} attributes The attributes objects contains references to custom attributes defined\n             * on the metadata object.\n             *\n             * @description\n             * These properties are generated based of the attributes that are created for the the specific schema.\n             * As these properties are not defined on the schemas they're put on a separate attributes object.\n             * When there are no attributes defined for the object type, the attributes property will not be attached\n             * to the model.\n             *\n             * @see https://docs.dhis2.org/2.27/en/user/html/dhis2_user_manual_en_full.html#manage_attribute\n             */\n            Object.defineProperty(this, 'attributes', { value: attributes });\n\n            const getAttributeValues = () => pickAttributeValues(this);\n            const setAttributeValues = attributeValues => (this.attributeValues = attributeValues);\n            const setDirty = () => (this.dirty = true);\n            const attributeDefinitions = createPropertyDefinitionsForAttributes(\n                attributeProperties,\n                getAttributeValues,\n                setAttributeValues,\n                setDirty,\n            );\n\n            Object.defineProperties(attributes, attributeDefinitions);\n        }\n\n        this[DIRTY_PROPERTY_LIST] = new Set([]);\n    }\n\n    /**\n     * @static\n     *\n     * @param {ModelDefinition} modelDefinition ModelDefinition from which the model should be created\n     * @returns {Model} Returns an instance of the model.\n     *\n     * @description The static method is a factory method to create Model objects. It calls `new Model()` with the passed `ModelDefinition`.\n     *\n     * ```js\n     * let myModel = Model.create(modelDefinition);\n     * ```\n     */\n    static create(modelDefinition) {\n        return new Model(modelDefinition);\n    }\n}\n\nexport default Model;\n"],"file":"Model.js"}