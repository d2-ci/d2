{"version":3,"sources":["../../src/analytics/AnalyticsRequestBase.js"],"names":["AnalyticsRequestBase","endPoint","format","path","program","dimensions","filters","parameters","toLowerCase","options","sorted","encodedDimensions","map","dimension","items","Array","isArray","length","encodedItems","sort","join","filter","e","encodedFilters"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;;;AAEA;;;;;;;;;;;;IAYMA,oB;AACF,oCAQQ;AAAA,uFAAJ,EAAI;AAAA,iCAPJC,QAOI;AAAA,YAPJA,QAOI,iCAPO,WAOP;AAAA,+BANJC,MAMI;AAAA,YANJA,MAMI,+BANK,MAML;AAAA,YALJC,IAKI,QALJA,IAKI;AAAA,YAJJC,OAII,QAJJA,OAII;AAAA,mCAHJC,UAGI;AAAA,YAHJA,UAGI,mCAHS,EAGT;AAAA,gCAFJC,OAEI;AAAA,YAFJA,OAEI,gCAFM,EAEN;AAAA,mCADJC,UACI;AAAA,YADJA,UACI,mCADS,EACT;;AAAA;;AACJ,aAAKN,QAAL,GAAgBA,QAAhB;AACA,aAAKC,MAAL,GAAcA,OAAOM,WAAP,EAAd;AACA,aAAKL,IAAL,GAAYA,IAAZ;AACA,aAAKC,OAAL,GAAeA,OAAf;;AAEA,aAAKC,UAAL,GAAkBA,UAAlB;AACA,aAAKC,OAAL,GAAeA,OAAf;AACA,aAAKC,UAAL,gBAAuBA,UAAvB;AACH;;AAED;;;;;;;;;;;;;;;iCAWSE,O,EAAS;AACd;AACA,gBAAIJ,aAAa,KAAKA,UAAtB;;AAEA,gBAAII,WAAWA,QAAQC,MAAvB,EAA+B;AAC3BL,6BAAa,sBAAOA,UAAP,EAAmB,WAAnB,CAAb;AACH;;AAED,gBAAMM,oBAAoBN,WAAWO,GAAX,CAAe,iBAA0B;AAAA,oBAAvBC,SAAuB,SAAvBA,SAAuB;AAAA,oBAAZC,KAAY,SAAZA,KAAY;;AAC/D,oBAAIC,MAAMC,OAAN,CAAcF,KAAd,KAAwBA,MAAMG,MAAlC,EAA0C;AACtC,wBAAMC,eAAeJ,MAAMF,GAAN,iCAArB;AACA,wBAAIH,WAAWA,QAAQC,MAAvB,EAA+B;AAC3BQ,qCAAaC,IAAb;AACH;;AAED,2BAAUN,SAAV,SAAuBK,aAAaE,IAAb,CAAkB,GAAlB,CAAvB;AACH;;AAED,uBAAOP,SAAP;AACH,aAXyB,CAA1B;;AAaA,gBAAMZ,WAAW,CAAC,KAAKA,QAAN,EAAgB,KAAKE,IAArB,EAA2B,KAAKC,OAAhC,EAAyCiB,MAAzC,CAAgD;AAAA,uBAAK,CAAC,CAACC,CAAP;AAAA,aAAhD,EAA0DF,IAA1D,CAA+D,GAA/D,CAAjB;;AAEA,mBACOnB,QADP,SACmB,KAAKC,MADxB,mBAC4CS,kBAAkBS,IAAlB,CAAuB,aAAvB,CAD5C;AAGH;;AAED;;;;;;;;;;;;;;;;mCAaWX,O,EAAS;AAChB,gBAAIH,UAAU,KAAKA,OAAnB;;AAEA,gBAAIG,WAAWA,QAAQC,MAAvB,EAA+B;AAC3BJ,0BAAU,sBAAOA,OAAP,EAAgB,WAAhB,CAAV;AACH;;AAED,gBAAMiB,iBAAiBjB,QAAQM,GAAR,CAAY,iBAA0B;AAAA,oBAAvBC,SAAuB,SAAvBA,SAAuB;AAAA,oBAAZC,KAAY,SAAZA,KAAY;;AACzD,oBAAIC,MAAMC,OAAN,CAAcF,KAAd,KAAwBA,MAAMG,MAAlC,EAA0C;AACtC,wBAAMC,eAAeJ,MAAMF,GAAN,iCAArB;AACA,wBAAIH,WAAWA,QAAQC,MAAvB,EAA+B;AAC3BQ,qCAAaC,IAAb;AACH;;AAED,2BAAUN,SAAV,SAAuBK,aAAaE,IAAb,CAAkB,GAAlB,CAAvB;AACH;;AAED,uBAAOP,SAAP;AACH,aAXsB,CAAvB;;AAaA,gBAAIP,QAAQW,MAAZ,EAAoB;AAChB,qBAAKV,UAAL,CAAgBc,MAAhB,GAAyBE,cAAzB;AACH;;AAED,mBAAO,KAAKhB,UAAZ;AACH;;;;;;kBAGUP,oB","file":"AnalyticsRequestBase.js","sourcesContent":["import sortBy from 'lodash/sortBy';\nimport { customEncodeURIComponent } from '../lib/utils';\n\n/**\n * @private\n * @description\n * Class for constructing a request object to use for communicating with the analytics API endpoint.\n *\n * @param {!Object} options Object with analytics request options\n *\n * @requires module:lib/utils\n *\n * @memberof module:analytics\n * @abstract\n */\nclass AnalyticsRequestBase {\n    constructor({\n        endPoint = 'analytics',\n        format = 'json',\n        path,\n        program,\n        dimensions = [],\n        filters = [],\n        parameters = {},\n    } = {}) {\n        this.endPoint = endPoint;\n        this.format = format.toLowerCase();\n        this.path = path;\n        this.program = program;\n\n        this.dimensions = dimensions;\n        this.filters = filters;\n        this.parameters = { ...parameters };\n    }\n\n    /**\n     * @private\n     * @description\n     * Builds the URL to pass to the Api object.\n     * The URL includes the dimension(s) parameters.\n     * Used internally.\n     *\n     * @param {Object} options Optional configurations\n     *\n     * @returns {String} URL URL for the request with dimensions included\n     */\n    buildUrl(options) {\n        // at least 1 dimension is required\n        let dimensions = this.dimensions;\n\n        if (options && options.sorted) {\n            dimensions = sortBy(dimensions, 'dimension');\n        }\n\n        const encodedDimensions = dimensions.map(({ dimension, items }) => {\n            if (Array.isArray(items) && items.length) {\n                const encodedItems = items.map(customEncodeURIComponent);\n                if (options && options.sorted) {\n                    encodedItems.sort();\n                }\n\n                return `${dimension}:${encodedItems.join(';')}`;\n            }\n\n            return dimension;\n        });\n\n        const endPoint = [this.endPoint, this.path, this.program].filter(e => !!e).join('/');\n\n        return (\n            `${endPoint}.${this.format}?dimension=${encodedDimensions.join('&dimension=')}`\n        );\n    }\n\n    /**\n     * @private\n     * @description\n     * Builds the query object passed to the API instance.\n     * The object includes all the parameters added via with*() methods\n     * and the filters added via addDataFilter(), addPeriodFilter(), addOrgUnitFilter(), addFilter().\n     * The filters are handled by the API instance when building the final URL.\n     * Used internally.\n     *\n     * @param {Object} options Optional configurations\n     *\n     * @returns {Object} Query parameters\n     */\n    buildQuery(options) {\n        let filters = this.filters;\n\n        if (options && options.sorted) {\n            filters = sortBy(filters, 'dimension');\n        }\n\n        const encodedFilters = filters.map(({ dimension, items }) => {\n            if (Array.isArray(items) && items.length) {\n                const encodedItems = items.map(customEncodeURIComponent);\n                if (options && options.sorted) {\n                    encodedItems.sort();\n                }\n\n                return `${dimension}:${encodedItems.join(';')}`;\n            }\n\n            return dimension;\n        });\n\n        if (filters.length) {\n            this.parameters.filter = encodedFilters;\n        }\n\n        return this.parameters;\n    }\n}\n\nexport default AnalyticsRequestBase;\n"]}