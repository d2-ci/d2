{"version":3,"sources":["../../../src/datastore/__tests__/DataStore.spec.js"],"names":["jest","mock","describe","namespaces","keys","dataStore","apiMock","beforeEach","MockApi","DataStore","afterEach","mockReset","it","get","mockReturnValueOnce","Promise","resolve","then","namespace","expect","toBeInstanceOf","DataStoreNamespace","getKeys","res","toEqual","toHaveBeenCalledTimes","not","toHaveBeenCalled","catch","e","message","toBe","err","httpStatusCode","reject","toThrow","rejects","toBeDefined","error","join","done","Error","getAll","namespaceRes","delete","namespaceDel","toBeCalledWith","getDataStore","create","toHaveLength","has","hasNamespace"],"mappings":"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","sourcesContent":["import DataStore from '../../datastore/DataStore';\nimport DataStoreNamespace from '../../datastore/DataStoreNamespace';\nimport MockApi from '../../api/Api';\n\njest.mock('../../api/Api');\n\ndescribe('DataStore', () => {\n    const namespaces = ['DHIS', 'History', 'social-media-video'];\n    const keys = ['key1', 'a key', 'aowelfkxuw'];\n    let dataStore;\n    let apiMock;\n\n    beforeEach(() => {\n        apiMock = new MockApi();\n        dataStore = new DataStore(apiMock);\n    });\n\n    afterEach(() => {\n        MockApi.mockReset();\n    });\n\n    describe('get()', () => {\n        it('should return an instance of datastorenamespace', () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(namespaces));\n\n            return dataStore.get('DHIS').then((namespace) => {\n                expect(namespace).toBeInstanceOf(DataStoreNamespace);\n            });\n        });\n\n\n        it('should return a datastorenamespace with keys if it exists', () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(namespaces))\n                .mockReturnValueOnce(Promise.resolve(keys));\n\n            return dataStore.get('DHIS').then(namespace => namespace.getKeys().then((res) => {\n                expect(res).toEqual(keys);\n                expect(apiMock.get).toHaveBeenCalledTimes(2);\n            }));\n        });\n\n        it('should not request API if autoload is false', () => dataStore.get('DHIS', false).then((res) => {\n            expect(res).toBeInstanceOf(DataStoreNamespace);\n            expect(apiMock.get).not.toHaveBeenCalled();\n        }));\n\n        it('should throw an error when no response', () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(null));\n\n            return dataStore.get('DHIS').catch((e) => {\n                expect(e.message).toBe('The requested namespace has no keys or does not exist.');\n            });\n        });\n\n        it('should throw an error if namespace does not exist on server', () => {\n            const err = { httpStatusCode: 404 };\n            apiMock.get.mockReturnValueOnce(Promise.reject(err));\n\n            return expect(dataStore.get('DHIS').catch((e) => {\n                expect(e).toThrow();\n            })).rejects.toBeDefined();\n        });\n\n        it('should throw when error is not 404', () => {\n            const error = { httpStatusCode: 500 };\n            apiMock.get.mockReturnValueOnce(Promise.reject(error));\n\n            return dataStore.get('DHIS')\n                .catch((e) => {\n                    expect(e).toEqual(error);\n                });\n        });\n\n        describe('for an invalid namespace', () => {\n            beforeEach(() => {\n                apiMock.get.mockReturnValueOnce(Promise.reject([\n                    '{',\n                    '\"httpStatus\":\"Not Found\",',\n                    '\"httpStatusCode\":404,',\n                    '\"status\":\"ERROR\",',\n                    '\"message\":\"The namespace \\'not-my-namespace\\' was not found.\"',\n                    '}',\n                ].join('')));\n            });\n\n            it('should throw an error', (done) => {\n                return dataStore.get('not-my-namespace').then(() => {\n                    throw new Error('this should have failed');\n                }).catch(() => done());\n            });\n        });\n    });\n\n    describe('getAll()', () => {\n        it('should return an array of namespaces', (done) => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(namespaces));\n            dataStore\n                .getAll()\n                .then((namespaceRes) => {\n                    expect(namespaces).toEqual(namespaceRes);\n                    done();\n                })\n                .catch(done);\n        });\n\n        it('should throw an error when there is no response', (done) => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(null));\n\n            return dataStore.getAll()\n                .then(done)\n                .catch((namespaceRes) => {\n                    expect(namespaceRes.message).toBe('No namespaces exist.');\n                    done();\n                });\n        });\n    });\n\n    describe('delete()', () => {\n        beforeEach(() => {\n            apiMock.delete.mockReturnValueOnce(Promise.resolve());\n        });\n\n        it('should call the api with correct url', () => {\n            const namespaceDel = 'DHIS';\n\n            return dataStore.delete(namespaceDel).then(() => {\n                expect(apiMock.delete).toBeCalledWith(`dataStore/${namespaceDel}`);\n            });\n        });\n    });\n\n    describe('getDataStore', () => {\n        it('should return an instance of DataStore', () => {\n            expect(DataStore.getDataStore()).toBeInstanceOf(DataStore);\n        });\n\n        it('should return the same object when called twice', () => {\n            expect(DataStore.getDataStore()).toBe(DataStore.getDataStore());\n        });\n    });\n\n    describe('create()', () => {\n        it('should return an instance of DataStore if namespace do not exist', () => {\n            const error = { httpStatusCode: 404 };\n            apiMock.get.mockReturnValueOnce(Promise.reject(error));\n\n            return dataStore.create('DHIS').then((namespace) => {\n                expect(namespace).toBeInstanceOf(DataStoreNamespace);\n                expect(namespace.keys).toHaveLength(0);\n            });\n        });\n\n        it('should return an error if namespace exists', () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(keys));\n\n            return dataStore.get('DHIS').then((namespace) => {\n                expect(namespace).toBeInstanceOf(DataStoreNamespace);\n            });\n        });\n    });\n\n    describe('has', () => {\n        it('should resolve with true if namespace exists', async () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve(keys));\n            const hasNamespace = await dataStore.has('DHIS');\n            expect(hasNamespace).toBe(true);\n        });\n\n        it('should resolve with false if namespace does not exists (404 from server)', async () => {\n            const err = { httpStatusCode: 404 };\n            apiMock.get.mockReturnValueOnce(Promise.reject(err));\n            const hasNamespace = await dataStore.has('arandomnamespace');\n            expect(hasNamespace).toBe(false);\n        });\n\n        it('should resolve with false if namespace does not exists (empty array)', async () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve([]));\n            const hasNamespace = await dataStore.has('arandomnamespace');\n            expect(hasNamespace).toBe(false);\n        });\n\n        it('should throw an error if resolved response is not an array', async () => {\n            apiMock.get.mockReturnValueOnce(Promise.resolve({}));\n            await expect(dataStore.has('arandomnamespace')).rejects.toBeDefined();\n        });\n\n        it('should throw an error if rejected response is not 404 or empty array ', async () => {\n            const err = { httpStatusCode: 500 };\n            apiMock.get.mockReturnValueOnce(Promise.resolve(err));\n            await expect(dataStore.has('arandomnamespace')).rejects.toBeDefined();\n        });\n    });\n});\n"],"file":"DataStore.spec.js"}